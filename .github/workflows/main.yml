name: Sync to Hugging Face Hub

on:
  push:
    branches:
      - main  # Or whichever branch you want to sync from

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the GitHub repo
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true

      # Step 2: Install Hugging Face Hub CLI (optional but convenient)
      - name: Install Hugging Face Hub CLI
        run: |
          pip install --upgrade huggingface_hub

      # Step 3: Create repo on Hugging Face if it doesn't exist
      - name: Ensure Hugging Face repo exists
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python - <<'EOF'
          from huggingface_hub import HfApi
          import os

          api = HfApi()
          token = os.environ["HF_TOKEN"]
          repo_id = "Auro-connect/ghAuroville_chatbot"

          # Check if repo exists, otherwise create it
          try:
              api.repo_info(repo_id)
              print(f"âœ… Repo {repo_id} already exists.")
          except Exception:
              print(f"ðŸš€ Creating repo {repo_id} on Hugging Face Hub...")
              api.create_repo(repo_id, token=token, private=False)
              print(f"âœ… Repo created successfully.")
          EOF

      # Step 4: Push your main branch to the Hugging Face repo
      - name: Push to Hugging Face Hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          git remote add hf "https://Auro-connect:${HF_TOKEN}@huggingface.co/Auro-connect/ghAuroville_chatbot"
          git push hf main --force
