name: Sync to Hugging Face Hub

on:
  push:
    branches:
      - main

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true  # âœ… Important to pull LFS-tracked files correctly

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install git-lfs -y
          git lfs install

      - name: Track binary files
        run: |
          git lfs track "*.xlsx"
          git add .gitattributes
          git add input/whatapp\ group\ event\ details.xlsx
          git commit -m "Track binary files with Git LFS" || echo "No changes to commit"

      - name: Install Hugging Face Hub CLI
        run: pip install --upgrade huggingface_hub

      - name: Ensure Hugging Face repo exists
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python - <<'EOF'
          from huggingface_hub import HfApi
          import os

          api = HfApi()
          token = os.environ["HF_TOKEN"]
          repo_id = "Auro-connect/ghAuroville_chatbot"

          try:
              api.repo_info(repo_id)
              print(f"âœ… Repo {repo_id} already exists.")
          except Exception:
              print(f"ðŸš€ Creating repo {repo_id} on Hugging Face Hub...")
              api.create_repo(repo_id, token=token, private=False)
              print(f"âœ… Repo created successfully.")
          EOF

      - name: Push to Hugging Face Hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          git remote add hf "https://Auro-connect:${HF_TOKEN}@huggingface.co/Auro-connect/ghAuroville_chatbot"
          git push hf main --force
